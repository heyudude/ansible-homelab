---
- name: Configure APT sources
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: 0644
  loop:
    - { src: sources.list.j2, dest: /etc/apt/sources.list }
    - { src: pve-no-subscription.list.j2, dest: /etc/apt/sources.list.d/pve-no-subscription.list }

- name: Remove PVE Enterprise repo
  ansible.builtin.file:
    path: /etc/apt/sources.list.d/pve-enterprise.list
    state: absent

- name: Upgrade packages
  ansible.builtin.package:
    update_cache: yes
    state: latest
    name: '*'

- name: Install packages
  ansible.builtin.package:
    state: present
    name:
      - openvswitch-switch
      - patch
      - pve-headers
