---
- hosts: localhost
  connection: local
  gather_facts: no

  vars:
    ldap_users:
      - uid: piv
        givenname: Ilya
        sn: Pavlov
        password: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            66343764333931306339666562646261393538333239303164376531306564373465373430323163
            3339383637653065326437316138343062343261386132370a396634346261363062366462623333
            37656337653031316662346130373666353535646438306131373964653433333162313738353037
            3961313430363330310a313837393938613537326535623466383432656334616632653035663833
            31353964613161623438363862373564613638353131353035383438653866653831
        attrs:
          - name: mailAlias
            value: postmaster@{{ inventory__site }}
          - name: mailAlias
            value: "@{{ inventory__site }}"

      - uid: pvm
        givenname: Vladimir
        sn: Pavlov
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32353038626238306462356534353536356432633438663961653361346462326464616561363035
          3462353765303964656235633266623766346134333763300a616233616636666431653862643063
          32353936353534373734626231636461393433383832636637323563303736393033353861656136
          6331316339353932630a646262353866376635326531396538303838363732383061353066343937
          6431

      - uid: noreply
        givenname: noreply
        sn: noreply
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37366162373630373464633862343165373637313732633237376433643137646263623338313134
          3839343830663832386239623663366133393462383339380a393330633939653538316331366166
          64616339376261626562306135313038323839636232636262396265313537363066356261613337
          6132633466393339660a656438353134326133633464386632313861343638396236306432396437
          62306338306265333833343330316366666137626161653761323934396264643263

      - uid: ansible
        givenname: ansible
        sn: ansible
        password: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            62346131386537646134383531346462646539346331323232343630323432366136316333393366
            3664646362393037373837353965306536396435613333310a666164346635656534386537353132
            34393232346534666235333132336162396331656664356131313030323135626265633331666633
            6239653536313664340a636161373834363131393235396332323866326439656165353865373162
            3831

  tasks:
    - name: manage homelab users
      include_tasks: roles/homelab_svc/mgmt/tasks/freeipa_user.yml
      loop_control:
        loop_var: user
      loop: "{{ ldap_users }}"
      args:
        apply:
          tags: create_users
      tags: create_users
