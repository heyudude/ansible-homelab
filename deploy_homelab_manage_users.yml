---
- hosts: localhost
  connection: local
  gather_facts: no

  vars:
    ldap_users:
      - uid: piv
        givenname: Ilya
        sn: Pavlov
        password: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            39343938643036643937306434393161323262333865653338643939306266623362643438366564
            3436353630323163316466656465613235336261613661650a633238646334643434303366383739
            61656637656433366237666336326639363963303033343432363463343066393262353038303063
            6566376262653833320a393533306339376466666561333134333462396563313439616234393536
            32313064336530303561626165643933666163643538633461333534626365393965
        attrs:
          - name: mailAlias
            value: "postmaster@devmem.ru"
          - name: mailAlias
            value: "@devmem.ru"

      - uid: pvm
        givenname: Vladimir
        sn: Pavlov
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64353162356265626130636235666364383931373032336437336265366238373766646364643966
          6637366635646532623235666265663765363031353165360a383037336464346233336364313532
          61636338353866643037386432313531663130636665633566356438393365303935306532633931
          3738323932303734660a323736386366623838626166653266623365383263306139623538653131
          3739

      - uid: noreply
        givenname: noreply
        sn: noreply
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34383138383533303362626662626235653861616339643536323465373262303064316365666365
          6535356536323436383364633432316138653939346331620a623164643030313564653936323763
          34303431343461313561626366356665343135383232653363636364653862323133616533393761
          3164303233343337650a656338386335616630343137343735316238663032633533366262393137
          61613737396330356538333530636162623131376334373065333237633936366561

      - uid: ansible
        givenname: ansible
        sn: ansible
        password: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            35366633623661616265623166643231653935343161323637643334306635363562646335313539
            6564356566613336636239326536366431616365303564320a333135613735326336643466356534
            38353565663365656363643331306433343664633766306565393035356565623638616130356136
            3132343937653837300a333838376334323635666132643265633066393463393062343863613033
            6537

  tasks:
    - name: manage homelab users
      include_tasks: roles/homelab_svc/mgmt/tasks/freeipa_user.yml
      loop_control:
        loop_var: user
      loop: "{{ ldap_users }}"
      args:
        apply:
          tags: create_users
      tags: create_users
