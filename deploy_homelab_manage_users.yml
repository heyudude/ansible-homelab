---
- hosts: localhost
  connection: local
  gather_facts: no

  vars:
    ldap_users:
      - uid: piv
        givenname: Ilya
        sn: Pavlov
        password: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            39343938643036643937306434393161323262333865653338643939306266623362643438366564
            3436353630323163316466656465613235336261613661650a633238646334643434303366383739
            61656637656433366237666336326639363963303033343432363463343066393262353038303063
            6566376262653833320a393533306339376466666561333134333462396563313439616234393536
            32313064336530303561626165643933666163643538633461333534626365393965
        attrs:
          - name: mailAlias
            value: postmaster@devmem.ru

      - uid: ansible
        givenname: ansible
        sn: ansible
        password: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            35366633623661616265623166643231653935343161323637643334306635363562646335313539
            6564356566613336636239326536366431616365303564320a333135613735326336643466356534
            38353565663365656363643331306433343664633766306565393035356565623638616130356136
            3132343937653837300a333838376334323635666132643265633066393463393062343863613033
            6537

  tasks:
    - name: manage homelab users
      include_tasks: roles/homelab_svc/mgmt/tasks/freeipa_user.yml
      loop_control:
        loop_var: user
      loop: "{{ ldap_users }}"
      args:
        apply:
          tags: create_users
      tags: create_users
